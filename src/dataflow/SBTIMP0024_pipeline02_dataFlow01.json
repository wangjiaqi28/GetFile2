{
    "name": "SBTIMP0024_pipeline02_dataFlow01",
    "properties": {
        "description": "差分ファイルと最新の全量ファイルから、「全量基軸ファイル（日付なし）」「全量基軸ファイル（日付あり）」「差分基軸ファイル」を出力するアクティビティ",
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "dataset": {
                        "referenceName": "SBTIMP0024_pipeline02_dataFlow01_dataset01",
                        "type": "DatasetReference"
                    },
                    "name": "SBTIMP0024Pipeline02DataFlow01Source01",
                    "description": "当日差分固定長WKファイルを読込む"
                },
                {
                    "dataset": {
                        "referenceName": "SBTIMP0024_pipeline02_dataFlow01_dataset03",
                        "type": "DatasetReference"
                    },
                    "name": "SBTIMP0024Pipeline02DataFlow01Source02"
                }
            ],
            "sinks": [
                {
                    "dataset": {
                        "referenceName": "SBTIMP0024_pipeline02_dataFlow01_dataset02",
                        "type": "DatasetReference"
                    },
                    "name": "SBTIMP0024Pipeline02DataFlow01Sink01",
                    "description": "当日差分基軸ファイルを出力する"
                },
                {
                    "dataset": {
                        "referenceName": "SBTIMP0024_pipeline02_dataFlow01_dataset02",
                        "type": "DatasetReference"
                    },
                    "name": "SBTIMP0024Pipeline02DataFlow01Sink02",
                    "description": "全量基軸ファイル（日付あり）を出力する"
                }
            ],
            "transformations": [
                {
                    "name": "SBTIMP0024Pipeline02DataFlow01Exists01",
                    "description": "前回の全量データと当日差分データを比較し、前回の全量データにのみ存在するレコードを抽出"
                },
                {
                    "name": "SBTIMP0024Pipeline02DataFlow01Union01",
                    "description": "「前回の全量データ」にのみ存在するレコードと「当日差分」データをUNIONする"
                }
            ],
            "scriptLines": [
                "parameters{",
                "     core_diff_file_name as string,",
                "     core_all_file_name as string",
                "}",
                "source(output(",
                "          PARTNR as string,",
                "          SPRAS as string,",
                "          ZAEPAANA as string,",
                "          ZAEPAAKNA as string,",
                "          ZAEPAANA_EN as string,",
                "          ZAEPANA1 as string,",
                "          ZAEPANA2 as string,",
                "          ZAEPANA1_EN as string,",
                "          ZAEPANA2_EN as string,",
                "          ZAEPAKNA as string,",
                "          LAND1 as string,",
                "          ZAEPAAD1 as string,",
                "          ZAEPAAD2 as string,",
                "          ZAEPAAD3 as string,",
                "          ZAEPAKAD as string,",
                "          ZAEPAAD1_EN as string,",
                "          ZAEPAAD2_EN as string,",
                "          ZAEPAAD3_EN as string,",
                "          ZAEPAAD4 as string,",
                "          PSTLZ as string,",
                "          TELF1 as string,",
                "          BLAND as string,",
                "          DATE_TO as string,",
                "          KOINH as string,",
                "          BKONT as string,",
                "          ZAEPADB as string,",
                "          ZAEPATSR as string,",
                "          ZAEPATDB as string,",
                "          URL as string,",
                "          SORTL as string,",
                "          ZAEPAIE as string,",
                "          ZAEPATRE as string,",
                "          ZAEPABRF as string,",
                "          ZAEPADEN as string,",
                "          ZAEPAHEP as string,",
                "          ZAETSBT as string,",
                "          SWIFT as string,",
                "          ZAEGFLG as string,",
                "          ZAEBAMS as string,",
                "          ZAEPADI as string,",
                "          ZAEPAAP as string,",
                "          ZAEPASEC as string,",
                "          ZAEPAGR1 as string,",
                "          ZAEPAGR2 as string,",
                "          ZAEPAGR3 as string,",
                "          ZAEPARE as string,",
                "          ZAEPAPIO as string,",
                "          LZONE as string,",
                "          ZAEPAORG as string,",
                "          ZAEPAAFME as string,",
                "          ZAEPAITI as string,",
                "          ZAEPAINVE as string,",
                "          ZAEPARESU as string,",
                "          ZAEPARESP as string,",
                "          ZAEPASEAC as string,",
                "          ZAEPACAAC as string,",
                "          ZAEPAWAOL as string,",
                "          ZAEPACONV as string,",
                "          ZAEPAMAC as string,",
                "          ZAEPAHE as string,",
                "          ZAEPAJU as string,",
                "          ZAEPACOMP as string,",
                "          ZAEPACOTR as string,",
                "          ZAEPACOLA as string,",
                "          ZAEPACOLL as string,",
                "          ZAEPAEQ as string,",
                "          ZAEPATA as string,",
                "          ZAEPAST as string,",
                "          ZAEPASITU as string,",
                "          ZAEPAHAV as string,",
                "          ZAEPANECO as string,",
                "          ZAEPACAEQ as string,",
                "          ZAEKTSR as string,",
                "          ZAEKODB as string,",
                "          ERDATE as string,",
                "          ERUSNM as string,",
                "          EDDATE as string,",
                "          EDUSNM as string,",
                "          LVORM as string,",
                "          ZAEIFNW as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     purgeFiles: true) ~> SBTIMP0024Pipeline02DataFlow01Source01",
                "source(output(",
                "          PARTNR as string,",
                "          SPRAS as string,",
                "          ZAEPAANA as string,",
                "          ZAEPAAKNA as string,",
                "          ZAEPAANA_EN as string,",
                "          ZAEPANA1 as string,",
                "          ZAEPANA2 as string,",
                "          ZAEPANA1_EN as string,",
                "          ZAEPANA2_EN as string,",
                "          ZAEPAKNA as string,",
                "          LAND1 as string,",
                "          ZAEPAAD1 as string,",
                "          ZAEPAAD2 as string,",
                "          ZAEPAAD3 as string,",
                "          ZAEPAKAD as string,",
                "          ZAEPAAD1_EN as string,",
                "          ZAEPAAD2_EN as string,",
                "          ZAEPAAD3_EN as string,",
                "          ZAEPAAD4 as string,",
                "          PSTLZ as string,",
                "          TELF1 as string,",
                "          BLAND as string,",
                "          DATE_TO as string,",
                "          KOINH as string,",
                "          BKONT as string,",
                "          ZAEPADB as string,",
                "          ZAEPATSR as string,",
                "          ZAEPATDB as string,",
                "          URL as string,",
                "          SORTL as string,",
                "          ZAEPAIE as string,",
                "          ZAEPATRE as string,",
                "          ZAEPABRF as string,",
                "          ZAEPADEN as string,",
                "          ZAEPAHEP as string,",
                "          ZAETSBT as string,",
                "          SWIFT as string,",
                "          ZAEGFLG as string,",
                "          ZAEBAMS as string,",
                "          ZAEPADI as string,",
                "          ZAEPAAP as string,",
                "          ZAEPASEC as string,",
                "          ZAEPAGR1 as string,",
                "          ZAEPAGR2 as string,",
                "          ZAEPAGR3 as string,",
                "          ZAEPARE as string,",
                "          ZAEPAPIO as string,",
                "          LZONE as string,",
                "          ZAEPAORG as string,",
                "          ZAEPAAFME as string,",
                "          ZAEPAITI as string,",
                "          ZAEPAINVE as string,",
                "          ZAEPARESU as string,",
                "          ZAEPARESP as string,",
                "          ZAEPASEAC as string,",
                "          ZAEPACAAC as string,",
                "          ZAEPAWAOL as string,",
                "          ZAEPACONV as string,",
                "          ZAEPAMAC as string,",
                "          ZAEPAHE as string,",
                "          ZAEPAJU as string,",
                "          ZAEPACOMP as string,",
                "          ZAEPACOTR as string,",
                "          ZAEPACOLA as string,",
                "          ZAEPACOLL as string,",
                "          ZAEPAEQ as string,",
                "          ZAEPATA as string,",
                "          ZAEPAST as string,",
                "          ZAEPASITU as string,",
                "          ZAEPAHAV as string,",
                "          ZAEPANECO as string,",
                "          ZAEPACAEQ as string,",
                "          ZAEKTSR as string,",
                "          ZAEKODB as string,",
                "          ERDATE as string,",
                "          ERUSNM as string,",
                "          EDDATE as string,",
                "          EDUSNM as string,",
                "          LVORM as string,",
                "          ZAEIFNW as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false,",
                "     skipLines: 1) ~> SBTIMP0024Pipeline02DataFlow01Source02",
                "SBTIMP0024Pipeline02DataFlow01Source02, SBTIMP0024Pipeline02DataFlow01Source01 exists(trim(SBTIMP0024Pipeline02DataFlow01Source02@PARTNR) == SBTIMP0024Pipeline02DataFlow01Source01@PARTNR,",
                "     negate:false,",
                "     broadcast: 'auto')~> SBTIMP0024Pipeline02DataFlow01Exists01",
                "SBTIMP0024Pipeline02DataFlow01Exists01, SBTIMP0024Pipeline02DataFlow01Source01 union(byName: true)~> SBTIMP0024Pipeline02DataFlow01Union01",
                "SBTIMP0024Pipeline02DataFlow01Source01 sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     partitionFileNames:[($core_diff_file_name)],",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     header: (array(concat(\"PARTNR\",\",SPRAS\",\",ZAEPAANA_ja\",\",ZAEPAAKNA\",\",ZAEPAANA_en\",\",ZAEPANA1_ja\",\",ZAEPANA2_ja\",\",ZAEPANA1_en\",\",ZAEPANA2_en\",\",ZAEPAKNA\",\",LAND1\",\",ZAEPAAD1_ja\",\",ZAEPAAD2_ja\",\",ZAEPAAD3_ja\",\",ZAEPAKAD\",\",ZAEPAAD1_en\",\",ZAEPAAD2_en\",\",ZAEPAAD3_en\",\",ZAEPAAD4\",\",PSTLZ\",\",TELF1\",\",BLAND\",\",DATE_TO\",\",KOINH\",\",BKONT\",\",ZAEPADB\",\",ZAEPATSR\",\",ZAEPATDB\",\",URL\",\",SORTL\",\",ZAEPAIE\",\",ZAEPATRE\",\",ZAEPABRF\",\",ZAEPADEN\",\",ZAEPAHEP\",\",ZAETSBT\",\",SWIFT\",\",ZAEGFLG\",\",ZAEBAMS\",\",ZAEPADI\",\",ZAEPAAP\",\",ZAEPASEC\",\",ZAEPAGR1\",\",ZAEPAGR2\",\",ZAEPAGR3\",\",ZAEPARE\",\",ZAEPAPIO\",\",LZONE\",\",ZAEPAORG\",\",ZAEPAAFME\",\",ZAEPAITI\",\",ZAEPAINVE\",\",ZAEPARESU\",\",ZAEPARESP\",\",ZAEPASEAC\",\",ZAEPACAAC\",\",ZAEPAWAOL\",\",ZAEPACONV\",\",ZAEPAMAC\",\",ZAEPAHE\",\",ZAEPAJU\",\",ZAEPACOMP\",\",ZAEPACOTR\",\",ZAEPACOLA\",\",ZAEPACOLL\",\",ZAEPAEQ\",\",ZAEPATA\",\",ZAEPAST\",\",ZAEPASITU\",\",ZAEPAHAV\",\",ZAEPANECO\",\",ZAEPACAEQ\",\",ZAEKTSR\",\",ZAEKODB\",\",ERDATE\",\",ERUSNM\",\",EDDATE\",\",EDUSNM\",\",LVORM\",\",ZAEIFNW\"))),",
                "     saveOrder: 1,",
                "     partitionBy('hash', 1)) ~> SBTIMP0024Pipeline02DataFlow01Sink01",
                "SBTIMP0024Pipeline02DataFlow01Union01 sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     partitionFileNames:[($core_all_file_name)],",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     header: (array(concat(\"PARTNR\",\",SPRAS\",\",ZAEPAANA_ja\",\",ZAEPAAKNA\",\",ZAEPAANA_en\",\",ZAEPANA1_ja\",\",ZAEPANA2_ja\",\",ZAEPANA1_en\",\",ZAEPANA2_en\",\",ZAEPAKNA\",\",LAND1\",\",ZAEPAAD1_ja\",\",ZAEPAAD2_ja\",\",ZAEPAAD3_ja\",\",ZAEPAKAD\",\",ZAEPAAD1_en\",\",ZAEPAAD2_en\",\",ZAEPAAD3_en\",\",ZAEPAAD4\",\",PSTLZ\",\",TELF1\",\",BLAND\",\",DATE_TO\",\",KOINH\",\",BKONT\",\",ZAEPADB\",\",ZAEPATSR\",\",ZAEPATDB\",\",URL\",\",SORTL\",\",ZAEPAIE\",\",ZAEPATRE\",\",ZAEPABRF\",\",ZAEPADEN\",\",ZAEPAHEP\",\",ZAETSBT\",\",SWIFT\",\",ZAEGFLG\",\",ZAEBAMS\",\",ZAEPADI\",\",ZAEPAAP\",\",ZAEPASEC\",\",ZAEPAGR1\",\",ZAEPAGR2\",\",ZAEPAGR3\",\",ZAEPARE\",\",ZAEPAPIO\",\",LZONE\",\",ZAEPAORG\",\",ZAEPAAFME\",\",ZAEPAITI\",\",ZAEPAINVE\",\",ZAEPARESU\",\",ZAEPARESP\",\",ZAEPASEAC\",\",ZAEPACAAC\",\",ZAEPAWAOL\",\",ZAEPACONV\",\",ZAEPAMAC\",\",ZAEPAHE\",\",ZAEPAJU\",\",ZAEPACOMP\",\",ZAEPACOTR\",\",ZAEPACOLA\",\",ZAEPACOLL\",\",ZAEPAEQ\",\",ZAEPATA\",\",ZAEPAST\",\",ZAEPASITU\",\",ZAEPAHAV\",\",ZAEPANECO\",\",ZAEPACAEQ\",\",ZAEKTSR\",\",ZAEKODB\",\",ERDATE\",\",ERUSNM\",\",EDDATE\",\",EDUSNM\",\",LVORM\",\",ZAEIFNW\"))),",
                "     saveOrder: 2,",
                "     partitionBy('hash', 1)) ~> SBTIMP0024Pipeline02DataFlow01Sink02"
            ]
        }
    }
}